image: gitpod/workspace-full

tasks:
  - name: Install AWS CLI v2
    env:
      AWS_CLI_AUTO_PROMPT=on-partial
    init: |
      # --- Dynamically detect repo + workspace paths ---
      GITPOD_REPO_ROOT=${GITPOD_REPO_ROOT:-$PWD}
      GITPOD_WORKSPACE_ROOT=${GITPOD_WORKSPACE_ROOT:-$(dirname "$GITPOD_REPO_ROOT")}

      echo "Repo root: $GITPOD_REPO_ROOT"
      echo "Workspace root: $GITPOD_WORKSPACE_ROOT"

      # --- Install AWS CLI globally (outside repo) ---
      cd "$GITPOD_WORKSPACE_ROOT"
      curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
      unzip -q awscliv2.zip
      sudo ./aws/install
      rm -rf aws awscliv2.zip

      # --- Return to your repo directory ---
      cd "$GITPOD_REPO_ROOT"
      echo "AWS CLI installed successfully!"
      aws --version

    command: |
      echo "Workspace ready!"